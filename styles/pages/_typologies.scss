@use "sass:color";
@use '../utils/variables' as *;
@use '../utils/mixins' as *;
@use "../components/separation-section" as *;
@use "../components/boutons" as *;


/* Scope page */
body.page-typologies {
    font-family: $font-body;
    color: #031837;
    background-color: $creme;
    line-height: 1.6;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    overflow-x: hidden;

    img { max-width: 100%; height: auto; display: block; }
    a { text-decoration: none; color: inherit; }
    
    h1 {
    color: $bleu;
    font-family: $font-titles;
    font-weight: 800;
    font-size: $h1-size;
    text-align: center;
    line-height: 1.18;
    padding: clamp(0.5rem, 0.143rem + 0.952vw, 1rem);
    }

    h2 {
        font-family: $font-titles;
        font-size: $h2-size;
        color: $vert1;
        margin-bottom: 1.5rem;
        line-height: clamp(2.2rem,5vw,3rem);
    }

    p { 
        font-size: $p-size;
        text-align: justify;
        line-height: 1.8; 
        margin-bottom: 1.2rem; 
    }



    main {
        
        .intro {
            // background-color: $creme;
            padding: $padding-marge-section;
            color: $bleu;
        
            .intro-container {
                width: min(1100px, 92vw);
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: clamp(1rem, 0.286rem + 1.905vw, 2rem);
                align-items: center;
                max-width: 1100px;
                margin: 0 auto;

                @media (max-width: 768px) {
                grid-template-columns: 1fr;
                }
                
                .intro-text {
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    height: 100%;
                    font-size: $p-size;
                    line-height: 1.5;
                }

                .intro-ul {
                    margin-left: clamp(0.5rem, 0.169rem + 2.034vw, 2rem);
                }

                .intro-ul li {
                    margin-bottom: clamp(0rem, -0.357rem + 0.952vw, 0.5rem);
                }

                .intro-ul li:hover {
                    color: $vert1;
                }
        
                .intro-image {
                    display: flex;
                    justify-self: flex-end;
                    @include cpe-zoom-frame(8s, ease-in-out, true, 1.05, -2%, -2%);
                    @include radius-cpe;
                    overflow: hidden;
                    box-shadow: $shadow-photo;
                    width: $witdh-img-500;
                    img {
                        width: 100%;
                        display: block;
                        margin: 0 auto;
                        height: 100%;
                        object-fit: cover;
                        display: block;
                    }
                }
                @media (max-width:933px){
                    .intro-image {
                        justify-self: center;
                        margin-bottom: 1rem;
                    }
                }

                .cta-buttons {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: clamp(0.8rem, 1.6vw, 1.2rem);
                margin: clamp(1rem, 0.78rem + 1.356vw, 2rem) 0 1rem;
                }
            }
        }


        .etapes {
            padding: $padding-marge-section;
            padding-bottom: clamp(1.25rem, 2.5vw, 2rem);
            color: $bleu;
            text-align: justify;

            .etapes-container {
                width: min(1100px, 92vw);
                margin: 0 auto;

                h4 { font-size: $h4-size; color: $violet; }

                .etapes-list {
                counter-reset: principe;
                list-style: none;
                margin: 1.2rem 0 0;
                padding: 0;
                display: grid;
                gap: 0.9rem;
                }

                .etapes-list > .etape {
                margin: 0;
                padding-bottom: 1.2rem;
                display: grid;
                gap: clamp(0.75rem, -0.2rem + 3vw, 2rem);
                align-items: start;
                grid-auto-rows: auto;
                grid-template-columns: 1fr;
                }

                .etapes-list > .etape:last-child { padding-bottom: 0; }

                .etape-text { text-align: left; }

                .etape-media {
                width: $witdh-img-defaut;
                aspect-ratio: 2 / 3;
                @include radius-cpe;
                overflow: hidden;
                box-shadow: $shadow-photo;

                img {
                    width: $witdh-img-500;
                    height: 100%;
                    display: block;
                    object-fit: cover;
                    object-position: center;
                }
                }

                .etape-text > h5 {
                font-size: $h5-size;
                display: flex;
                align-items: center;
                margin-bottom: 0.5rem;

                    &::before {
                        content: counter(principe);
                        counter-increment: principe;
                        flex: 0 0 auto;
                        aspect-ratio: 1 / 1;
                        width: 2.2rem;
                        min-width: 2.2rem;
                        border-radius: 50%;
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        background: $vert3;
                        color: $color-bg;
                        font-weight: 800;
                        font-size: 1rem;
                        margin-right: 1rem;
                    }
                }

                .etape-text > h5:hover {
                    color: $violet;
                }

                .bloc-flow {
                column-count: 1;
                column-gap: clamp(0.8rem, 2vw, 1.2rem);

                .bloc {
                    break-inside: avoid;
                    -webkit-column-break-inside: avoid;
                    page-break-inside: avoid;
                    margin: 0 0 clamp(0.6rem, 1.5vw, 1rem);

                    p { margin: 0 0 .3rem clamp(1rem, 0.286rem + 1.905vw, 2rem); font-size: $p-size; }
                    ul {
                    margin-left: clamp(1rem, 0.286rem + 1.905vw, 2rem); padding: 0; list-style: disc inside;
                    li { margin: .2rem 0; font-size: $p-size; line-height: 1.55; }
                    li:hover { color: $vert1; }
                    }
                    
                }

                .bloc:last-child { margin-bottom: 0; }
                }

                @media (min-width: 992px) {
                .etapes-list > .etape { grid-template-columns: 1fr 1fr 0.9fr; }
                .etape-text { grid-column: 1 / span 2; }
                .etape-media {
                    grid-column: 3;
                    grid-row: 1 / span 2;
                    justify-self: center;
                }
                .etapes-list > .etape:nth-child(even) { grid-template-columns: 0.9fr 1fr 1fr; }
                .etapes-list > .etape:nth-child(even) .etape-media {
                    grid-column: 1;
                    grid-row: 1 / span 2;
                    justify-self: center;
                }
                .etapes-list > .etape:nth-child(even) .etape-text { grid-column: 2 / span 2; }
                .bloc-flow { column-count: 2; }
                }

                @media (min-width: 769px) and (max-width: 991px) {
                .etapes-list > .etape { grid-template-columns: 1fr; }
                .etape-text { grid-column: 1; grid-row: 1; }
                .etape-media { grid-column: 1; grid-row: 2; justify-self: center; }
                .bloc-flow { column-count: 2; }
                }

                @media (max-width: 768px) {
                .etapes-list > .etape {
                    grid-template-columns: 1fr;
                    justify-items: stretch;
                    align-items: center;
                    gap: clamp(0.6rem, 2.5vw, 1rem);
                    padding-bottom: 1rem;
                }
                .etapes-list > .etape:last-child { padding-bottom: 0; }
                .etape-text {
                    grid-column: 1;
                    grid-row: 1;
                    width: 100%;
                    max-width: none;
                }
                .etape-media {
                    justify-self: center;
                    grid-column: 1;
                    grid-row: 2;
                    max-width: none;
                }
                .etape-text > h5 {
                    flex-direction: column;
                    gap: .4rem;
                    justify-content: flex-start;
                    text-align: center;

                    &::before {
                    width: clamp(1.8rem, 6vw, 2rem);
                    min-width: clamp(1.8rem, 6vw, 2rem);
                    font-size: .95rem;
                    margin-bottom: .1rem;
                    margin-right: 0;
                    }
                }
                .bloc-flow { column-count: 1; }
                }
            }
        }


        .specificites {
            padding: $padding-marge-section;
            color: $bleu;
            text-align: justify;

            .specificites-container {
                width: min(1100px, 92vw);
                margin: 0 auto;

            }
            
            .roles-grid {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;   /* centre chaque rangée */
                gap: clamp(0.8rem, -0.057rem + 2.286vw, 2rem);
                padding: clamp(1rem, 0.286rem + 1.905vw, 2rem);
            }

            .role-card {
                flex: 0 1 clamp(280px, 30vw, 340px);
                max-inline-size: 340px;
                width: 100%;
            }

            /* === Flip sans JS : hover + focus/tap (mobile) === */
            .flip-card { perspective: 1000px; display: block; outline: none; }
            .flip-inner { display: grid; transform-style: preserve-3d; transition: transform .45s ease; }
            .flip-card:hover .flip-inner,
            .flip-card:focus-within .flip-inner { transform: rotateY(180deg); }

            /* Overlay grid => hauteur AUTO = max(face, verso) */
            .flip-face {
                grid-area: 1 / 1;
                background: $background-saumon-blanc;
                border-top: $border-top-saumon;
                border-left: $border-left-saumon;
                border-radius: .4rem;
                border-bottom-right-radius: 1rem;
                border-top-left-radius: 1rem;
                box-shadow: $shadow-defaut;

                /* IMPORTANT pour éviter l’écrasement */
                height: auto;                 /* override de toute hauteur fixe résiduelle */
                min-height: clamp(5rem, 2.857rem + 5.714vw, 8rem);

                padding: 0.2rem;
                display: grid;
                place-items: center;
                text-align: center;
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden; backface-visibility: hidden;
            }

            .flip-face.back {
                transform: rotateY(180deg);
                background: $background-saumon-blanc-hover;

            }

            h3 { 
                font-size: $h4-size; 
                line-height: 1.2; 
                margin: 0; 
            }

            h4 { 
                font-size: $p-size; 
                line-height: 1.2; 
                margin-top: 0.5rem; 
                color: $vert1;
            }

            p {
                margin-bottom: 0;
                text-align: center;
            }

            .p-specificites {
                text-align: left;
            }

            @media (max-width: 600px) {
                .role-card { flex-basis: 100%; max-inline-size: none; }  /* 1 par ligne, centrée */
            }
        }


        .choix-typologie {
            padding: $padding-marge-section;
            color: $bleu;
            text-align: justify;

            h2 {
                width: min(1100px, 92vw);
                margin: 0 auto clamp(1rem, 0.78rem + 1.356vw, 2rem);
            }

            .choix-typologie-container {
                width: min(1100px, 92vw);
                margin: 0 auto;
                display: grid;
                grid-template-columns: 1fr 1fr 1fr 1fr;
                gap: 0;
                @include radius-cpe;
                border-top: $border-top-vert-2px;
                border-left: $border-left-vert;
                box-shadow: $shadow-photo;
                overflow: hidden;

                .colonne {
                display: grid;
                grid-template-rows: auto 1fr;
                align-content: start;
                }

                .h4-colonne {
                margin: 0;
                padding: .6rem 1rem;
                background: rgba($saumon, .6);
                color: $bleu;
                font-weight: 700;
                line-height: 1.25;
                border-bottom: 1px solid rgba($bleu, .6);
                text-align: center;
                border-left: 0;
                border-right: 0;
                }

                .colonne:not(:first-child) { border-inline-start: 0; }

                .col-list {
                list-style: none;
                margin: 0;
                padding: 0;

                li {
                    margin: 0;
                    padding: .75rem .9rem;
                    min-height: 2.75rem;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    text-align: center;
                    border-bottom: 1px solid rgba($bleu, .30);
                    background: $creme;
                    border-left: 0;
                    border-right: 0;
                }
                li:last-child { border-bottom: 0; }
                }

                /* Fonds / couleurs par colonne */
                #services .col-list li {
                background: rgba($violet, .10);
                color: color.scale($bleu, $lightness: -5%);
                }
                #travaux .col-list li {
                background: rgba($vert3, .10);
                color: color.scale($bleu, $lightness: -5%);
                }
                #tiers .col-list li {
                background: rgba($bleu, .10);
                color: color.scale($bleu, $lightness: -10%);
                }

                /* Bordures latérales (desktop) — TOUT EN BORDURE DROITE, sauf la dernière colonne */
                #critere  .h4-colonne,
                #services .h4-colonne,
                #travaux  .h4-colonne { border-right: 1px solid rgba($bleu, .5); }

                #critere  .col-list li,
                #services .col-list li,
                #travaux  .col-list li { border-right: 1px solid rgba($bleu, .5); }

                /* #tiers : pas de bordure droite ajoutée (le conteneur fournit le bord droit externe) */

                @media (hover: hover) and (pointer: fine) {
                .col-list li:hover { background: color.change($creme, $alpha: .6); }
                #services .col-list li:hover { background: color.change($violet, $alpha: .15); }
                #travaux  .col-list li:hover { background: color.change($vert3,  $alpha: .15); }
                #tiers    .col-list li:hover { background: color.change($bleu,   $alpha: .15); }
                }
            }

            /* Responsive ≤900px : mini-tableaux par ligne */
            @media (max-width: 1060px) {
                .h4-colonne { display: none;}

                .choix-typologie-container {
                display: flex;
                flex-wrap: wrap;
                border: 0;
                box-shadow: none;
                overflow: visible;
                background: transparent;
                }

                .choix-typologie-container .colonne,
                .choix-typologie-container .colonne > .col-list { display: contents; }

                .choix-typologie-container .col-list li {
                flex: 1 1 100%;
                display: grid;
                grid-template-columns: auto 1fr;
                align-items: start;
                gap: .6rem;
                text-align: left;
                padding: .8rem 1rem;
                background: $creme;
                border-bottom: 0;
                border-left: $border-left-vert;
                border-right: 0;
                }

                /* Libellés */
                #critere  .col-list li::before { content: "Critère : ";  font-weight: 700; color: $bleu; }
                #services .col-list li::before { content: "Services : "; font-weight: 700; color: color.scale($violet, $lightness: -10%); }
                #travaux  .col-list li::before { content: "Travaux : ";  font-weight: 700; color: color.scale($vert3,  $lightness: -10%); }
                #tiers    .col-list li::before { content: "Tiers : ";    font-weight: 700; color: color.scale($bleu,  $lightness: -10%); }

                /* Fonds (mobile) */
                #services .col-list li { background: rgba($violet, .10); }
                #travaux  .col-list li { background: rgba($vert3, .10); }
                #tiers    .col-list li { background: rgba($bleu,  .10); }

                /* Latérales UNIFORMES (mobile)
                - gauche du mini-tableau : border-left sur Critère
                - séparateurs internes : border-right sur Critère/Services/Travaux
                - droite du mini-tableau : border-right sur Tiers
                */
                #critere  .col-list li { border-left: $border-left-vert; border-right: 1px solid rgba($bleu, .5); }
                #services .col-list li { border-right: 1px solid rgba($bleu, .5); }
                #travaux  .col-list li { border-right: 1px solid rgba($bleu, .5); }
                #tiers    .col-list li { border-right: 1px solid rgba($bleu, .5); }

                /* Un seul cadre par mini-tableau */
                #critere  .col-list li { border-top: $border-top-vert-2px; border-radius: .6rem .6rem 0 0; }
                #services .col-list li { border-top: 1px solid rgba($bleu, .30); }
                #travaux  .col-list li { border-top: 1px solid rgba($bleu, .30); }
                #tiers    .col-list li { border-top: 1px solid rgba($bleu, .30); border-bottom: 2px solid color.scale($vert2, $lightness: -10%); border-radius: 0 0 .6rem .6rem; margin-bottom: .8rem; }

                /* Ordonnancement (6 lignes) */
                #critere  .col-list li:nth-child(1) { order: 1; }  #services .col-list li:nth-child(1) { order: 2; }  #travaux .col-list li:nth-child(1) { order: 3; }  #tiers .col-list li:nth-child(1) { order: 4; }
                #critere  .col-list li:nth-child(2) { order: 5; }  #services .col-list li:nth-child(2) { order: 6; }  #travaux .col-list li:nth-child(2) { order: 7; }  #tiers .col-list li:nth-child(2) { order: 8; }
                #critere  .col-list li:nth-child(3) { order: 9; }  #services .col-list li:nth-child(3) { order:10; }  #travaux .col-list li:nth-child(3) { order:11; }  #tiers .col-list li:nth-child(3) { order:12; }
                #critere  .col-list li:nth-child(4) { order:13; }  #services .col-list li:nth-child(4) { order:14; }  #travaux .col-list li:nth-child(4) { order:15; }  #tiers .col-list li:nth-child(4) { order:16; }
                #critere  .col-list li:nth-child(5) { order:17; }  #services .col-list li:nth-child(5) { order:18; }  #travaux .col-list li:nth-child(5) { order:19; }  #tiers .col-list li:nth-child(5) { order:20; }
                #critere  .col-list li:nth-child(6) { order:21; }  #services .col-list li:nth-child(6) { order:22; }  #travaux .col-list li:nth-child(6) { order:23; }  #tiers .col-list li:nth-child(6) { order:24; }
            }

            @media (prefers-reduced-motion: reduce) {
                .col-list li { transition: none !important; }
            }
        }


        .conseil {
            padding: $padding-marge-section;
            color: $bleu;
            text-align: justify;

            .conseil-container {
                width: min(1100px, 92vw);
                display: grid;
                grid-template-columns: 1fr 1fr;
                align-items: center;
                max-width: 1100px;
                margin: 0 auto;

                @media (max-width: 768px) {
                grid-template-columns: 1fr;
                }
                
                .conseil-text {
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    height: 100%;
                    padding: 1rem 0;
                    // gap: clamp(1rem, -0.429rem + 3.81vw, 3rem);
                    font-size: $p-size;
                    line-height: 1.5;


                    .cta-buttons {
                        display: flex;
                        flex-wrap: wrap;
                        justify-content: center;
                        gap: clamp(0.8rem, 1.6vw, 1.2rem);
                        margin: clamp(1rem, 0.78rem + 1.356vw, 2rem) 0 0;
                    }
                }

                .conseil-image {
                    display: flex;
                    justify-self: flex-end;
                    @include cpe-zoom-frame(8s, ease-in-out, true, 1.05, -2%, -2%);
                    @include radius-cpe;
                    overflow: hidden;
                    box-shadow: $shadow-photo;
                    width: $witdh-img-500;

                    img {
                    width: 100%;
                    display: block;
                    margin: 0 auto;
                    height: 100%;
                    object-fit: cover;
                    display: block;
                    }
                }
                @media (max-width:933px){
                    .conseil-image {
                        justify-self: center;
                        margin-bottom: 1rem;
                        margin-top: 1rem;
                    }
                }
            }
        }

    }
}


