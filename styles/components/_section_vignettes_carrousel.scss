@use '../utils/variables' as *;
@use '../utils/mixins' as *;

/* ============================
   SECTION avec image de fond
   ============================ */
.vignettes-section {
  position: relative;
  isolation: isolate;
  padding: $padding-marge-section;
  text-align: center;
  background: url('../images/photo-accueil_vignettes.webp') center/cover no-repeat;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(26,46,77,.75); /* voile foncé */
    z-index: 0;
    pointer-events: none;
  }

  * { position: relative; z-index: 1; }

  .vc-title {
    font-size: $h2-size;
    width: min(1100px, 92vw);
    margin: 0 auto;
    margin-bottom: 1.5rem;
    color: $creme;
    font-weight: 700;
  }
}

/* ============================
   CARROUSEL
   ============================ */
.vignettes-carousel {
  --edge-offset: clamp(2rem, (100vw - 1200px)/2 + 1rem, 12vw);
  --front-fs: $p-size;
  --back-fs: $p-size;
  --cta-fs: $p-size;
  --icon-fs: clamp(1.7rem, 3.57vw, 2.72rem);
  --front-grad-angle: 135deg;

  .vc-inner {
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
    isolation: isolate;
  }

  .vc-viewport {
    overflow: hidden;
    position: relative;
    width: 100%;
  }

  .vc-track {
    --gap: .6rem;
    --item-w: clamp(180px, 26vw, 260px);
    display: flex;
    gap: var(--gap);
    list-style: none;
    padding: 0;
    margin: 0;
    will-change: transform;
    transform: translateX(0);
  }

  .vc-item { flex: 0 0 var(--item-w); perspective: 1000px; }

  .vc-card {
    display: block;
    position: relative;
    min-height: clamp(120px, 18vw, 160px);
    transform-style: preserve-3d;
    transition: transform .6s ease;
    outline: 0;
    cursor: default;
    border-radius: .35em;
    border-bottom-right-radius: .9em;
    border-top-left-radius: .9em;
  }

  .vc-face {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    padding: .9rem 1rem;
    text-align: center;
    border: 1px solid rgba(26,46,77,.08);
    border-radius: .35em;
    border-bottom-right-radius: .9em;
    border-top-left-radius: .9em;
    box-shadow: 1px 2px 5px rgba(0,0,0,.15);
    backface-visibility: hidden;
    overflow: hidden;
  }

  /* Face avant */
  .vc-front {
    background: var(--front-bg, #fff);
    background-image: linear-gradient(
      var(--front-grad-angle),
      color-mix(in oklab, var(--front-bg, #fff) 96%, #fff) 0%,
      var(--front-bg, #fff) 70%,
      color-mix(in oklab, var(--front-bg, #fff) 90%, #000) 100%
    );
    color: var(--front-fg, $bleu);
    display: grid;
    gap: .45rem;
    place-items: center;
    padding-top: .2rem;
  }

  .vc-label { font-weight: var(--front-fw, 700); font-size: var(--front-fs); line-height: 1.15; }
  .vc-front .vc-icon { font-size: var(--icon-fs); line-height: 1; display: inline-block; }

  /* Face arrière */
  .vc-back {
    background: var(--back-bg, #fff);
    color: var(--back-fg, $bleu);
    transform: rotateY(180deg);
    gap: .25rem;
  }
  .vc-back, .vc-back * { font-size: var(--back-fs); }
  .vc-back p { margin: 0 0 .35rem 0; font-weight: 200; }

  /* Flip */
  .vc-card:hover,
  .vc-card:focus,
  .vc-card:focus-visible { transform: rotateY(180deg); }

  /* CTA */
  .vc-cta {
    display: inline-block;
    font-weight: 600;
    color: $vert1;
    font-size: var(--cta-fs);
    text-decoration: none;
  }
  .vc-cta:hover { color: $bleu; }

  /* ============================
     PALETTES fixes avec classes
     ============================ */
  .vc-item.vc-a {
    --front-bg: color-mix(in oklab, #{$bleu-accent} 22%, #{$creme});
    --front-fg: #{$bleu};
    --front-fw: 600;
    --back-bg:  #{$creme};
    --back-fg:  #{$bleu};
  }

  .vc-item.vc-b {
    --front-bg: color-mix(in oklab, #{$vert1} 28%, #{$creme});
    --front-fg: #{$bleu};
    --front-fw: 600;
    --back-bg:  #{$creme};
    --back-fg:  #{$bleu};
  }

  /* ============================
     BOUTONS — centrés et décalés
     ============================ */
  .vc-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 42px; height: 42px;
    border-radius: 999px;
    border: 1px solid rgba(26,46,77,.12);
    background: color-mix(in oklab, $creme 70%, #fff 30%);
    box-shadow: 0 2px 8px rgba(26,46,77,.15);
    display: grid; place-items: center;
    cursor: pointer; z-index: 2;
    transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
  }
  .vc-btn[disabled] { opacity: .35; pointer-events: none; }
  .vc-btn:hover { transform: translateY(calc(-50% - 1px)); box-shadow: 0 6px 14px rgba(26,46,77,.22); }

  .vc-prev { left: -3.5rem; }   /* décalage plus marqué */
  .vc-next { right: -3.5rem; }
  .vc-ico { font-size: 1.6rem; line-height: 1; color: $vert1; }

  @media (max-width: 640px) {
    .vc-btn { width: 36px; height: 36px; }
    .vc-ico { font-size: 1.4rem; }
    .vc-prev { left: .4rem; }   /* en mobile → docké à l’intérieur */
    .vc-next { right: .4rem; }

    & {
      --back-fs: clamp(.76rem, 3vw, .88rem);
      --cta-fs:  clamp(.76rem, 3vw, .88rem);
    }
  }

  @media (max-width: 380px) {
    & {
      --back-fs: clamp(.72rem, 3.4vw, .84rem);
      --cta-fs:  clamp(.72rem, 3.4vw, .84rem);
    }
  }
}
